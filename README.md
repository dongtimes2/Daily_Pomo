<div align="center" style="max-width: 100%;">
  <h1>Daily Pomo</h1>
  <img width="200" style="max-width: 100%" src="https://github.com/user-attachments/assets/759336e8-5eeb-4437-b189-6f99b6e26682"/><br/>
</div>

<hr/>
<div align="center" style="max-width: 100%;">

| [<img src="https://raw.githubusercontent.com/alrra/browser-logos/master/src/edge/edge_48x48.png" alt="IE / Edge" width="24px" height="24px" />](http://godban.github.io/browsers-support-badges/)<br/>Edge | [<img src="https://raw.githubusercontent.com/alrra/browser-logos/master/src/chrome/chrome_48x48.png" alt="Chrome" width="24px" height="24px" />](http://godban.github.io/browsers-support-badges/)<br/>Chrome | [<img src="https://raw.githubusercontent.com/alrra/browser-logos/master/src/safari/safari_48x48.png" alt="Safari" width="24px" height="24px" />](http://godban.github.io/browsers-support-badges/)<br/>Safari |
  | :---: | :---: | :---: |
  | 17.0 ~ latest | 50.0 ~ latest | (push 알림 미지원) 
</div>
<hr />

# 개요

- 프로젝트 이름: 🍅Daily Pomo🍅
- 프로젝트 소개: 포모도로 타이머 웹, PWA 어플리케이션
- 개발 기간
  - 최초 개발: 2024.12 ~ (기획 및 디자인 2일: 개발: 3일)

# 이용 방법

<details>
<summary>기본적 사용법</summary>
<div>

|메인화면||
|:---:|:---:|
|![main](https://github.com/user-attachments/assets/cfc01b59-2d7e-414b-9f0e-c5331a5ce824)|![blank](https://github.com/user-attachments/assets/922291da-1466-4810-b20e-ebeed7f84d3a)|
|메인 화면에는 세 개의 버튼이 있습니다.<br/>왼쪽 버튼은 타이머를 실행시킵니다.<br/>가운데 버튼은 타이머를 리셋 시킵니다.<br/>오른쪽 버튼은 모드를 변경시킵니다.||

|work mode|break mode|long break mode|
|:--:|:--:|:--:|
|![work mode](https://github.com/user-attachments/assets/cfc01b59-2d7e-414b-9f0e-c5331a5ce824)|![break mode](https://github.com/user-attachments/assets/622600dd-2e1b-4608-b677-91dd786d1b4e)|![long break mode](https://github.com/user-attachments/assets/fdd3e696-c598-49f8-a5a2-1eead33e8b91)|
|작업 시간 모드입니다.|휴식 시간 모드입니다.|일정 횟수의 작업 시간을 모두 마친 경우에 발생하는 긴 휴식 모드입니다.|
</div>
</details>

<details>
<summary>환경설정 변경</summary>
<div>

|설정 버튼 위치|설정 패널|
|:--:|:--:|
|![setting button](https://github.com/user-attachments/assets/8132475c-f842-43b7-afe0-7f6ef174daee)|![settings panel](https://github.com/user-attachments/assets/a0372e20-8eb4-4b30-b753-522529040d72)|
|헤더에 설정 버튼을 누를 경우, 환경 설정 패널을 호출할 수 있습니다.|설정 패널에서는 각각 모드에 할당되어있는 시간과, 긴 휴식 모드로 넘어가기 위해 몇 번의 작업 시간 모드를 완료해야 하는지를 설정할 수 있습니다.|
</div>
</details>

<details>
<summary>다크 모드 / 라이트 모드 변경</summary>
<div>

|모드 토글 버튼 위치||
|:--:|:--:|
|![dark mode toggle button](https://github.com/user-attachments/assets/5662d218-8a16-4c62-a3b6-b01235c1adfe)|![blank](https://github.com/user-attachments/assets/922291da-1466-4810-b20e-ebeed7f84d3a)|
|헤더에 라이트 모드 / 다크 모드 토글 버튼을 누를 경우, 앱의 테마를 변경할 수 있습니다.||

|라이트 모드 (작업)|다크 모드 (작업)|
|:--:|:--:|
|![work light mode](https://github.com/user-attachments/assets/f509ccca-8008-4e6d-945a-1d48064ed0ff)|![work dark mode](https://github.com/user-attachments/assets/9e9fa56d-8b1f-4d36-9568-5746941aa03d)|

|라이트 모드 (휴식)|다크 모드 (휴식)|
|:--:|:--:|
|![break light mode](https://github.com/user-attachments/assets/1c7e1cc7-457d-478f-98a5-55566158eace)|![break dark mode](https://github.com/user-attachments/assets/d71e3b65-6648-4645-8554-7abf21caf3c6)|

|라이트 모드 (긴 휴식)|다크 모드 (긴 휴식)|
|:--:|:--:|
|![long break light mode](https://github.com/user-attachments/assets/d6e7340c-dd42-4b01-807f-b1242aed389d)|![long break dark mode](https://github.com/user-attachments/assets/3d407422-3665-43df-be24-74d8eaee3127)|
</div>
</details>

<details>
<summary>PWA앱 다운로드 방법</summary>
<div>

|PWA 설치 방법|실행 방법|
|:--:|:--:|
|![how to download the pwa app](https://github.com/user-attachments/assets/4378260f-502a-47d2-b727-916e0e95cab0)|![how to execute the app](https://github.com/user-attachments/assets/20ae3b7c-4a10-478e-9331-2d8ef9fcfd98)|
|브라우저에서 실행시킬 때, PWA로 다운로드할 것인지를 묻는 기호가 나타납니다.<br/>이를 클릭하면 설치할 수 있습니다.|로컬 환경에서 프로그램 목록을 보면 설치된 것을 확인할 수 있습니다.|
</div>
</details>

# 기술 스택

### 핵심

- Next.js (App router)
  - SSR 지원으로 초기 로딩 성능 최적화.
  - 서버리스 함수를 통한 백엔드 로직 구현으로, 별도의 서버 인프라 구축 없이 간소화된 백엔드 환경 구성.

- Zustand
  - 가볍고 직관적인 상태관리를 위함.

- IndexedDB
  - 토큰 정보를 브라우저의 indexedDB에 저장하여 캐싱함으로써, 토큰 발급에 일어나는 비동기 과정에서 발생하는 오버헤드를 줄임.

- React-hook-form && Zod
  - 폼 입력 과정에서 발생하는 불필요한 리렌더링 최소화로 성능 최적화.
  - 런타임 과정에서 입력 값에 대한 유효성 검사가 용이하도록 함.

- Firebase
  - push 알림 구현을 위해 도입.

- service worker
  - 백그라운드 환경에서도 알림 정보를 수신할 수 있도록 하기 위함.
  - 백그라운드 환경에서도 타이머의 정확성을 보장하기 위함.

- TypeScript
- Tailwind

### 테스트 환경

- Vitest

### 배포

- Vercel

# 기술 및 구현 상세 내용

## 타이머 작동 과정

타이머는 앱이 백그라운드인 상태에서도 충분히 작동할 수 있어야 합니다.  
왜냐하면 앱 특성상 사람들은 타이머를 틀어놓고, 다른 작업을 주로 하는 경우가 많기 때문입니다.  
&nbsp;  
메인 스레드 단에서 setInterval로 타이머를 구현했을 경우, 백그라운드 상태에 진입했을 때 브라우저가 interval을 중지시킬 수 있으며, 경우에 따라 타이머의 시간 간격이 일정하지 않다는 문제점이 발생할 수 있습니다.  
따라서 상태에 관계없이 최대한 일정한 간격으로 동작하는 타이머를 제작하기 위해 worker를 이용하였습니다.  
&nbsp;  
![timer worker diagram](https://github.com/user-attachments/assets/6657f6b4-4463-4b96-b816-5823a9da8d99)

## 푸시 알림 작동 과정

### 기본 과정

타이머의 시간이 끝난 경우에는 알림 권한이 허용된 유저에 한하여, 푸시 알림을 보냅니다.  
상기한 다이어그램을 참조했을 때, 프론트엔드 단에서 COMPLETE 메시지를 수신했을 경우 프론트엔드는 토큰 정보와 함께 백엔드에게 푸시 알림 요청을 보냅니다.  

백엔드는 요청을 수신받은 경우 Firebase 서버에게 푸시 알림 요청을 보내며, 이때 토큰 정보도 함께 전달합니다.  

Firebase는 수신받은 요청의 토큰 값을 기반으로, 클라이언트(프론트엔드)에게 푸시 알림을 보냅니다.  

프론트엔드 로직에서는 푸시 알림을 수신받을 수 있는 worker가 탑재되어 있습니다. 
따라서 클라이언트(프론트엔드)는 푸시알림을 수신받을 수 있습니다.  

![push message diagram](https://github.com/user-attachments/assets/008913b1-572b-4dbb-afe0-5236c1990412)

### 토큰 처리

Firebase의 FCM 토큰은 만료기한이 따로 없습니다. (단 마지막 요청이 대략 1년을 넘어간 경우, 토큰이 만료됩니다)  
토큰을 한 번 발급받은 뒤 이를 브라우저에 저장하여 캐싱할 경우, 이후의 요청에서는 토큰을 발급받을 필요가 없기 때문에, 토큰 발급에 소요되는 비동기 과정의 오버헤드를 줄일 수 있을 것이라 판단했습니다.  
따라서 토큰 정보를 브라우저의 indexedDB에 저장하는 방법을 선택했습니다.  

앞서 상기한대로 토큰이 만료되었을 경우, 프론트엔드는 Firebase에게 다시 요청을 보내어, 새로운 토큰으로 캐싱합니다.  

## WCAG 2.1 준수

해당 앱의 디자인은 웹 접근성 가이드를 준수합니다.  
저시력자, 색각이상자도 불편함 없이 앱을 이용할 수 있도록, 모든 디자인은 WCAG 2.1 AAA을 만족합니다.

|라이트 모드|다크 모드|
|:--:|:--:|
|![light mode](https://github.com/user-attachments/assets/f509ccca-8008-4e6d-945a-1d48064ed0ff)|![dark mode](https://github.com/user-attachments/assets/3d407422-3665-43df-be24-74d8eaee3127)|

## light house perfect score 달성

light house의 평가지표에서 훌륭한 점수를 받았습니다.
<br/>
이를 통해 최고의 사용자 경험 및 접근성을 제공합니다.

<div align="center" style="max-width: 100%;">
  <img width="500" style="max-width: 100%" src="https://github.com/user-attachments/assets/afe8fec1-f336-4893-a6e4-9e470eb93189"/><br/>
</div>

# 개발 가이드

## 환경 변수

프로젝트 폴더 root 위치에 .env 파일을 만들고 다음과 같이 환경변수를 설정해주어야 합니다.

```
PROJECT_ID  // Firebase Admin SDK에서 발급받은 값.
CLIENT_EMAIL  // Firebase Admin SDK에서 발급받은 값.
PRIVATE_KEY  // Firebase Admin SDK에서 발급받은 값.
```

## 빌드

빌드할 경우, 결과물은 .next 폴더에 생성됩니다.

```sh
$ npm install

# 빌드 명령
$ npm run build
```

# version
node.js: 20.15.1(LTS), npm: 10.7.0 버전으로 개발되었습니다.  
.nvmrc 파일이 포함되어 있으므로, nvm이 설치되어있는 환경이라면 따로 버전을 설정할 필요가 없습니다.  
